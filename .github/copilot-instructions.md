npm run build    # Outputs to ../js/dist/
git push origin main
# AI Agent Instructions · The Moon Exports
- **Architecture**: Static HTML/CSS core served via GitHub Pages; progressive React/TypeScript layer in `react/` hydrates existing DOM using bundles emitted to `js/dist/`. Legacy and React code meet at `window.TheMoonExports.*` and must stay schema-compatible.
- **Key modules**: `js/navigation.js` (dropdown manager + a11y), `js/forms.js` (FormHandler + Zoho posts), `js/consent.js` (cookie banner + `onReady` queue), `react/src/components/Header.tsx` / `NewsletterForm.tsx` (hydrate & call legacy init), `react/src/hooks/useConsent.ts` (bridges consent state), `docs/PRODUCTION_READINESS_SUMMARY.md` & `.aicontext` for context.
- **Workflows**: For static edits open `index.html` or run `npm run dev` (Serve). For React work `cd react && npm install && npm run dev` (Vite at :5173); build with `npm run build` to refresh `js/dist/` (keep `emptyOutDir: false`). Run `npm run lint` before commits; `npm audit` for security. Manual QA follows `docs/TESTING_PLAN.md` (cross-browser, consent, accessibility).
- **Conventions**: Preserve hydration markers (`data-react="header"`, etc.) and mirror edits across `/de/` + `/fr/`. Use existing Bootstrap classes and extend styling via `css/one.css` with BEM-ish names (`.dropdown-hero`). Never mount React into blank containers—HTML must stay crawlable. All analytics loaders must sit behind `TheMoonExports.Consent.onReady()` or the `useConsent()` hook.
- **Interop rules**: When adding React components, expose any new legacy helpers under `window.TheMoonExports.*` and declare them in `react/src/types/global.d.ts`. Avoid introducing new jQuery (stick to vanilla/React). If React needs legacy behavior, call it inside `useEffect` after verifying it exists.
- **Testing/Debugging**: Dropdown issues → ensure `Navigation.init()` runs, ARIA roles intact, and console shows initialization count. Consent banner missing → clear `localStorage['tme_cookie_consent_v1']`, confirm `js/consent.js` loads before analytics stubs. Hydration mismatch → JSX must match static HTML byte-for-byte; ensure legacy scripts don’t mutate before React mounts.
- **Do not**: Remove `window.TheMoonExports` keys, change hreflang tags or language switcher paths, bypass consent gating, rename Bootstrap grid classes, or ship UA analytics changes without updating `legal/privacy.html`. Keep `js/dist/` outputs checked in only via the build step—no manual edits.
- **Next migrations**: Follow `react-refactoring.md` for incremental strangler rollout (header → newsletter → footer). Coordinate documentation updates in `docs/` whenever workflows or security posture change.

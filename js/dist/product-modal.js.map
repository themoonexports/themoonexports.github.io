{"version":3,"file":"product-modal.js","sources":["../../react/src/hooks/useProducts.ts","../../react/src/components/ProductModal.tsx","../../react/src/entries/product-modal.tsx"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\nimport type { Product } from '../types/Product';\n\nexport function useProducts() {\n  const [products, setProducts] = useState<Product[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetch('/products.json')\n      .then((res) => {\n        if (!res.ok) throw new Error('Failed to load products.json');\n        return res.json();\n      })\n      .then((data) => {\n        // Normalize data:\n        // - Ensure images[] exists and includes primary image first\n        // - Sort by productId (TME-XX) for deterministic display\n        const norm: Product[] = (data as Product[]).map((p) => {\n          const images = Array.isArray(p.images) ? p.images.slice() : [];\n          if (p.image && (!images.length || images[0] !== p.image)) {\n            // Put primary at the front if absent or not first\n            const withoutPrimary = images.filter((i) => i !== p.image);\n            images.splice(0, images.length, p.image, ...withoutPrimary);\n          }\n          return { ...p, images };\n        }).sort((a, b) => {\n          const parseNum = (s?: string) => {\n            const m = (s || '').match(/TME-(\\d+)/i);\n            return m ? parseInt(m[1], 10) : Number.MAX_SAFE_INTEGER;\n          };\n          return parseNum(a.productId) - parseNum(b.productId);\n        });\n        setProducts(norm);\n        setLoading(false);\n      })\n      .catch((err) => {\n        setError(err.message);\n        setLoading(false);\n      });\n  }, []);\n\n  const byId = useMemo(() => new Map(products.map((p) => [p.id, p])), [products]);\n  const byProductId = useMemo(() => new Map(products.map((p) => [p.productId, p])), [products]);\n  const byCategory = useMemo(() => {\n    return products.reduce<Record<string, Product[]>>((acc, p) => {\n      (acc[p.category] ||= []).push(p);\n      return acc;\n    }, {});\n  }, [products]);\n\n  return { products, byId, byProductId, byCategory, loading, error };\n}\n","import React, { useEffect, useMemo, useState } from 'react';\nimport type { Product } from '../types/Product';\nimport { useProducts } from '../hooks/useProducts';\n\nfunction getLocale(): 'en' | 'de' | 'fr' {\n  const lang = (document.documentElement.getAttribute('lang') || 'en').toLowerCase();\n  if (lang.startsWith('de')) return 'de';\n  if (lang.startsWith('fr')) return 'fr';\n  return 'en';\n}\n\nfunction localizedName(p: Product, locale: 'en' | 'de' | 'fr') {\n  if (locale === 'de' && p.name_de) return p.name_de;\n  if (locale === 'fr' && p.name_fr) return p.name_fr;\n  return p.name;\n}\n\nfunction localizedDescription(p: Product, locale: 'en' | 'de' | 'fr') {\n  if (locale === 'de' && p.description_de) return p.description_de;\n  if (locale === 'fr' && p.description_fr) return p.description_fr;\n  return p.description;\n}\n\nconst ProductModal: React.FC = () => {\n  const { products, loading, error } = useProducts();\n  const [openIdx, setOpenIdx] = useState<number | null>(null);\n  const [activeImageIdx, setActiveImageIdx] = useState(0);\n  const [activeVariantImage, setActiveVariantImage] = useState<string | null>(null);\n\n  const locale = getLocale();\n\n  // Choose a small, stable featured subset: first 6 by productId\n  const featured = useMemo(() => products.slice(0, 6), [products]);\n\n  useEffect(() => {\n    if (openIdx === null) return;\n    const handler = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') setOpenIdx(null);\n      if (e.key === 'ArrowRight') setActiveImageIdx((i) => i + 1);\n      if (e.key === 'ArrowLeft') setActiveImageIdx((i) => Math.max(0, i - 1));\n    };\n    window.addEventListener('keydown', handler);\n    return () => window.removeEventListener('keydown', handler);\n  }, [openIdx]);\n\n  const currentProduct: Product | null = openIdx !== null ? featured[openIdx] : null;\n  const gallery = useMemo(() => {\n    if (!currentProduct) return [] as string[];\n    const imgs = currentProduct.images && currentProduct.images.length > 0\n      ? currentProduct.images\n      : [currentProduct.image];\n    // If a variant is selected, ensure it's shown as the current image\n    if (activeVariantImage) {\n      const idx = imgs.indexOf(activeVariantImage);\n      if (idx > 0) {\n        const copy = imgs.slice();\n        const [sel] = copy.splice(idx, 1);\n        copy.unshift(sel);\n        return copy;\n      }\n    }\n    return imgs;\n  }, [currentProduct, activeVariantImage]);\n\n  useEffect(() => {\n    // Reset indices on open/close\n    setActiveImageIdx(0);\n    setActiveVariantImage(null);\n  }, [openIdx]);\n\n  const nextImage = () => setActiveImageIdx((i) => Math.min(i + 1, Math.max(0, gallery.length - 1)));\n  const prevImage = () => setActiveImageIdx((i) => Math.max(0, i - 1));\n\n  const loadingLabel = locale === 'de' ? 'Wird geladen…' : locale === 'fr' ? 'Chargement…' : 'Loading…';\n\n  return (\n    <div className=\"product-modal\" data-react=\"product-modal\">\n      <h2>{locale === 'de' ? 'Ausgewählte Produkte' : locale === 'fr' ? 'Produits en vedette' : 'Featured Products'}</h2>\n\n      {loading && <p aria-live=\"polite\">{loadingLabel}</p>}\n      {error && <p role=\"alert\">{error}</p>}\n\n      {!loading && !error && (\n        <ul className=\"product-list\">\n          {featured.map((p, idx) => (\n            <li key={p.productId}>\n              <button className=\"product-btn btn-crafts\" onClick={() => setOpenIdx(idx)}>\n                {localizedName(p, locale)}\n              </button>\n            </li>\n          ))}\n        </ul>\n      )}\n\n      {currentProduct && (\n        <div className=\"modal-overlay\" role=\"dialog\" aria-modal=\"true\">\n          <div className=\"modal-content card-crafts\">\n            <button className=\"close-btn btn-icon-crafts\" onClick={() => setOpenIdx(null)} aria-label={locale === 'de' ? 'Schließen' : locale === 'fr' ? 'Fermer' : 'Close'}>×</button>\n\n            <h3>{localizedName(currentProduct, locale)}</h3>\n            <p>{localizedDescription(currentProduct, locale)}</p>\n\n            <div className=\"lightbox\">\n              <div className=\"lightbox-main\">\n                <img\n                  src={gallery[Math.min(activeImageIdx, gallery.length - 1)]}\n                  alt={localizedName(currentProduct, locale)}\n                  width={400}\n                  height={300}\n                />\n                <div className=\"lightbox-controls\">\n                  <button onClick={prevImage} aria-label={locale === 'de' ? 'Vorheriges Bild' : locale === 'fr' ? 'Image précédent' : 'Previous image'} className=\"btn-icon-crafts\">&lsaquo;</button>\n                  <span className=\"lightbox-index\">{Math.min(activeImageIdx, gallery.length - 1) + 1}/{gallery.length}</span>\n                  <button onClick={nextImage} aria-label={locale === 'de' ? 'Nächstes Bild' : locale === 'fr' ? 'Image suivant' : 'Next image'} className=\"btn-icon-crafts\">&rsaquo;</button>\n                </div>\n              </div>\n              {gallery.length > 1 && (\n                <ul className=\"lightbox-thumbs\" aria-label={locale === 'de' ? 'Bildergalerie' : locale === 'fr' ? 'Galerie d’images' : 'Image gallery'}>\n                  {gallery.map((src, i) => (\n                    <li key={src}>\n                      <button\n                        className={i === activeImageIdx ? 'thumb active' : 'thumb'}\n                        onClick={() => setActiveImageIdx(i)}\n                        aria-current={i === activeImageIdx}\n                      >\n                        <img src={src} alt=\"\" width={72} height={54} />\n                      </button>\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </div>\n\n            {currentProduct.variants && currentProduct.variants.length > 0 && (\n              <div className=\"variants\">\n                <h4>{locale === 'de' ? 'Varianten' : locale === 'fr' ? 'Variantes' : 'Variants'}</h4>\n                <ul className=\"variant-list\">\n                  {currentProduct.variants.map((v) => (\n                    <li key={v.id}>\n                      <button\n                        className={activeVariantImage === v.image ? 'variant chip-crafts active' : 'variant chip-crafts'}\n                        onClick={() => setActiveVariantImage(v.image)}\n                      >\n                        {v.name}\n                      </button>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ProductModal;\n","import React from 'react';\nimport { createRoot } from 'react-dom/client';\nimport ProductModal from '../components/ProductModal';\n\nconst mount = document.querySelector('.product-modal[data-react=\"product-modal\"]');\nif (mount) {\n  createRoot(mount).render(<ProductModal />);\n}\n"],"names":["useProducts","products","setProducts","useState","loading","setLoading","error","setError","useEffect","res","data","norm","p","images","withoutPrimary","i","a","b","parseNum","s","m","err","byId","useMemo","byProductId","byCategory","acc","_a","getLocale","lang","localizedName","locale","localizedDescription","ProductModal","openIdx","setOpenIdx","activeImageIdx","setActiveImageIdx","activeVariantImage","setActiveVariantImage","featured","handler","e","currentProduct","gallery","imgs","idx","copy","sel","nextImage","prevImage","loadingLabel","jsxs","jsx","src","v","mount","createRoot"],"mappings":"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"}